// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  resetToken String?
  resetTokenExpires DateTime?
  
  profiles Profile[]
}

model Profile {
  id        String   @id @default(cuid())
  name      String
  age       Int
  gender    String
  createdAt DateTime @default(now())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  prescriptions Prescription[]
  labReports    LabReport[]
  reminders     Reminder[]
}

model Prescription {
  id            String   @id @default(cuid())
  profile_id    String
  date          String
  doctor        String
  diagnosis     String
  medicines     Medicine[]
  follow_up_date String?
  file_url      String
  createdAt     DateTime @default(now())
  
  profile Profile @relation(fields: [profile_id], references: [id], onDelete: Cascade)
}

model Medicine {
  id            String @id @default(cuid())
  name          String
  dosage        String
  frequency     String
  duration_days Int
  prescription  Prescription @relation(fields: [prescriptionId], references: [id], onDelete: Cascade)
  prescriptionId String
}

model LabReport {
  id        String     @id @default(cuid())
  profile_id String
  date      String
  test_name String
  values    LabValue[]
  file_url  String
  createdAt DateTime @default(now())
  
  profile Profile @relation(fields: [profile_id], references: [id], onDelete: Cascade)
}

model LabValue {
  id            String @id @default(cuid())
  name          String
  value         Float
  reference_range String
  status        String // "low", "normal", "high"
  labReport     LabReport @relation(fields: [labReportId], references: [id], onDelete: Cascade)
  labReportId   String
}

model Reminder {
  id               String   @id @default(cuid())
  profile_id       String
  medicine_name    String
  time             String
  repeat_frequency String
  duration_days    Int
  completed_days   Int      @default(0)
  created_at       DateTime @default(now())
  
  profile Profile @relation(fields: [profile_id], references: [id], onDelete: Cascade)
}
